<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <title>GIS4102C Midterm - USA Weather Reports</title>

    <link rel="stylesheet" href="https://js.arcgis.com/4.29/esri/themes/light/main.css" />
    <script src="https://js.arcgis.com/4.29/"></script>

    <style>
      html,
      body,
      #viewDiv {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
      }
    </style>

    <script>
      require([
        "esri/config", "esri/Map", "esri/views/MapView", "esri/layers/ImageryLayer", "esri/layers/FeatureLayer", "esri/widgets/Legend", "esri/widgets/Search"], (esriConfig, Map, MapView, ImageryLayer, FeatureLayer, Legend, Search) => {

         esriConfig.apiKey = "AAPK1765fcbd73fc4425b0cd59bdc8917e2bmcTlBpvn58EXkohap6CpN2AW0fqzLT6uVWDm397RXqEqWOhZxic16ypSWD1WQhY_";
         const map = new Map({
          basemap: "arcgis-topographic"
          
        });

        const view = new MapView({
        container: "viewDiv",
        map: map,
        zoom: 5,
        center: [-100, 40]
        });

        // Adding Weather Watches and Warnings featurelayer from feature service (0)
      const WeatherReport = new FeatureLayer({
      // URL to the service
      url: "https://services9.arcgis.com/RHVPKKiFTONKtxq3/arcgis/rest/services/NWS_Watches_Warnings_v1/FeatureServer",
      title: "USA Weather Watches and Warnings"
      
      });

      // Adding Public Forecast Zones featurelayer from feature service (0)
      const PublicForecastZones = new FeatureLayer({
      // URL to the service
      url: "https://services9.arcgis.com/RHVPKKiFTONKtxq3/arcgis/rest/services/NWS_Watches_Warnings_v1/FeatureServer/1",
      title: "USA Weather Watches and Warnings"
      
      });

      // Adding Public Forecast Zones featurelayer from feature service (0)
      const FireForecastZones = new FeatureLayer({
      // URL to the service
      url: "https://services9.arcgis.com/RHVPKKiFTONKtxq3/arcgis/rest/services/NWS_Watches_Warnings_v1/FeatureServer/2",
      title: "Fire Forecast Zones"
      
      });

      // Adding Public Forecast Zones featurelayer from feature service (0)
      const USCounties = new FeatureLayer({
      // URL to the service
      url: "https://services9.arcgis.com/RHVPKKiFTONKtxq3/arcgis/rest/services/NWS_Watches_Warnings_v1/FeatureServer/3",
      title: "US Counties"
      
      });

      // Adding Public Forecast Zones featurelayer from feature service (0)
      const USStatesTerritories = new FeatureLayer({
      // URL to the service
      url: "https://services9.arcgis.com/RHVPKKiFTONKtxq3/arcgis/rest/services/NWS_Watches_Warnings_v1/FeatureServer/4",
      title: "US States and Territories"
      
      });


      // Adding Public Forecast Zones featurelayer from feature service (0)
      const CoastalOffshoreMarineZones = new FeatureLayer({
      // URL to the service
      url: "https://services9.arcgis.com/RHVPKKiFTONKtxq3/arcgis/rest/services/NWS_Watches_Warnings_v1/FeatureServer/5",
      title: "Coastal and Offshore Marine Zones"
      
      });

// Defining a popup template for feature layer
const popupTemplate = {
  title: "<i><b>Event:</b> {Event}<br></i>",
  content: "<b>Urgency:</b> {Urgency}<br><b>Severity:</b> {Severity}<br><b>Summary:</b> {Summary}<br><b>Affected:</b> {Affected}<br><b>Updated:</b> {Updated}<br>"
}

// Adding Public Forecast Zones featurelayer from feature service (0)
const EventsSizeSeverity = new FeatureLayer({
// URL to the service
  url: "https://services9.arcgis.com/RHVPKKiFTONKtxq3/arcgis/rest/services/NWS_Watches_Warnings_v1/FeatureServer/6",
  title: "Events Ordered by Size and Severity",
  outFields: ["Urgency","Severity","Summary","Affected","Updated"],
  popupTemplate: popupTemplate
      
});

// Create featurelayer from feature service
const MinorEvents = new FeatureLayer({
  url: "https://services9.arcgis.com/RHVPKKiFTONKtxq3/arcgis/rest/services/NWS_Watches_Warnings_v1/FeatureServer/11",
  title: "Minor Events",
  outFields: ["Urgency","Severity","Summary","Affected","Updated"],
  popupTemplate: popupTemplate
});

const ModerateEvents = new FeatureLayer({
  url: "https://services9.arcgis.com/RHVPKKiFTONKtxq3/arcgis/rest/services/NWS_Watches_Warnings_v1/FeatureServer/10",
  title: "Moderate Events",
  outFields: ["Urgency","Severity","Summary","Affected","Updated"],
  popupTemplate: popupTemplate
});

const SevereEvents = new FeatureLayer({
  url: "https://services9.arcgis.com/RHVPKKiFTONKtxq3/arcgis/rest/services/NWS_Watches_Warnings_v1/FeatureServer/9",
  title: "Severe Events",
  outFields: ["Urgency","Severity","Summary","Affected","Updated"],
  popupTemplate: popupTemplate
});

const ExtremeEvents = new FeatureLayer({
  url: "https://services9.arcgis.com/RHVPKKiFTONKtxq3/arcgis/rest/services/NWS_Watches_Warnings_v1/FeatureServer/8",
  title: "Extreme Events",
  outFields: ["Urgency","Severity","Summary","Affected","Updated"],
  popupTemplate: popupTemplate
});


// Create featurelayer from feature service
const OtherEvents = new FeatureLayer({
 // URL to the service
  url: "https://services9.arcgis.com/RHVPKKiFTONKtxq3/arcgis/rest/services/NWS_Watches_Warnings_v1/FeatureServer/12",
  title: "Other Events",
  outFields: ["Urgency","Severity","Summary","Affected","Updated"],
  popupTemplate: popupTemplate    
  });

    // Adding the feature layers to the map
    map.addMany([WeatherReport, PublicForecastZones, FireForecastZones, USCounties, USStatesTerritories, CoastalOffshoreMarineZones, MinorEvents, ModerateEvents, SevereEvents, ExtremeEvents, EventsSizeSeverity]);

const layersToShowInLegend = [WeatherReport, PublicForecastZones, FireForecastZones, USCounties, USStatesTerritories, CoastalOffshoreMarineZones, EventsSizeSeverity];    
      let legend = new Legend({
      view: view,
      layerInfos: layersToShowInLegend.map(layer => ({
        layer: layer,
        title: layer.title
       }))
      });

      view.ui.add(legend, "bottom-right");

      const searchWidget = new Search({
      view: view
      });
      // Adds the search widget below other elements in
      // the top left corner of the view
      view.ui.add(searchWidget, {
      position: "top-left",
      index: 2
      });


;

      });
    </script>
  </head>

  <body>
    <div id="viewDiv"></div>
  </body>
</html>